!function(u){function e(e){for(var t,n,r=e[0],s=e[1],o=e[2],a=0,i=[];a<r.length;a++)n=r[a],l[n]&&i.push(l[n][0]),l[n]=0;for(t in s)Object.prototype.hasOwnProperty.call(s,t)&&(u[t]=s[t]);for(h&&h(e);i.length;)i.shift()();return d.push.apply(d,o||[]),c()}function c(){for(var e,t=0;t<d.length;t++){for(var n=d[t],r=!0,s=1;s<n.length;s++){var o=n[s];0!==l[o]&&(r=!1)}r&&(d.splice(t--,1),e=a(a.s=n[0]))}return e}var n={},l={0:0},d=[];function a(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return u[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=u,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/dist/";var t=window.webpackJsonp=window.webpackJsonp||[],r=t.push.bind(t);t.push=e,t=t.slice();for(var s=0;s<t.length;s++)e(t[s]);var h=r;d.push([10,1]),c()}({10:function(e,t,n){"use strict";n.r(t);var r=n(1),s=n(9),o=r.a.start(),a=n(11);o.load(Object(s.a)(a))},11:function(e,t,n){var r={"./send_controller.js":12};function s(e){var t=o(e);return n(t)}function o(e){var t=r[e];if(t+1)return t;var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}s.keys=function(){return Object.keys(r)},s.resolve=o,(e.exports=s).id=11},12:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return d});var o=n(1),r=n(3),a=n.n(r);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,c(t).apply(this,arguments))}var n,r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,o["b"]),n=t,s=[{key:"targets",get:function(){return["sourceAccount","address","amount","destinations","destinationTemplate","changeAddress","changeAmount","errors","customInput","customTxRow","customInputContent","changeOutputsTarget","submitButton","nextButton","removeDestinationButton","form","walletPassphrase","passwordError","useCustom","spendUnconfirmed","errorMessage","successMessage","progressBar"]}}],(r=[{key:"initialize",value:function(){this.newDestination()}},{key:"validateSendForm",value:function(){this.errorsTarget.innerHTML="";var e=[],t=this.validateDestinationsField();if(""===this.sourceAccountTarget.value&&e.push("The source account is required"),this.useCustomTarget.value&&this.getSelectedInputsSum()<this.getTotalSendAmount()&&e.push("The sum of selected inputs is less than send amount"),e.length){for(var n in e)this.showError(e[n]);t=!1}return t}},{key:"validateAndRefreshPercentage",value:function(){this.validateDestinationsField()&&this.calculateSelectedInputPercentage()}},{key:"validateDestinationsField",value:function(){var n=this;this.clearMessages();var r=!0;return this.addressTargets.forEach(function(e,t){""===e.value&&(n.showError("The destination address and amount are required"),r=!1)}),this.amountTargets.forEach(function(e,t){0<parseFloat(e.value)||(n.showError("Amount must be a non-zero positive number"),r=!1)}),r}},{key:"getSelectedInputsSum",value:function(){var n=0;return this.customTxRowTarget.querySelectorAll("input.custom-input:checked").forEach(function(e,t){n+=parseFloat(e.dataset.amount)}),n}},{key:"getTotalSendAmount",value:function(){var n=0;return this.amountTargets.forEach(function(e,t){n+=parseFloat(e.value)}),n}},{key:"calculateSelectedInputPercentage",value:function(){var e=this.getTotalSendAmount(),t=this.getSelectedInputsSum(),n=0;n=e<=t?100:t/e*100,this.progressBarTarget.style.width=n+"%"}},{key:"resetCustomizePanel",value:function(){var t=this;this.customTxRowTarget.querySelectorAll("tbody").forEach(function(e){e.innerHTML=""}),this.customTxRowTarget.querySelectorAll(".status").forEach(function(e){t.show(e)}),this.customTxRowTarget.querySelectorAll(".alert-danger").forEach(function(e){e.parentNode.removeChild(e)})}},{key:"openCustomizePanel",value:function(){var n=this;this.resetCustomizePanel(),$("#custom-tx-row").slideDown();var e=n.sourceAccountTarget.value;this.getUnspentOutputs(e,function(e){var t=e.map(function(e){var t=new Date(1e3*e.receive_time).toString().split(" ").slice(0,5).join(" "),n=e.amount/1e8;return"<tr>\n                  <td width='5%'><input data-action='click->send#calculateSelectedInputPercentage' type='checkbox' class='custom-input' name='utxo' value='".concat(e.key,"' data-amount='").concat(n,"' /></td>\n                  <td width='40%'>").concat(e.address,"</td>\n                  <td width='15%'>").concat(n," DCR</td>\n                  <td width='25%'>").concat(t,"</td>\n                  <td width='15%'>").concat(e.confirmations," confirmation(s)</td>\n                </tr>")});n.customInputContentTarget.innerHTML=t,$("#custom-tx-row .status").hide()})}},{key:"getUnspentOutputs",value:function(e,n){this.submitButtonTarget.innerHTML="Loading...",this.submitButtonTarget.setAttribute("disabled","disabled");var r=this,t="/unspent-outputs/"+e;r.spendUnconfirmedTarget.checked&&(t+="?getUnconfirmed=true"),a.a.get(t).then(function(e){var t=e.data;t.success?n(t.message):r.setErrorMessage(t.message)}).catch(function(){r.setErrorMessage("A server error occurred")}).then(function(){r.submitButtonTarget.innerHTML="Next",r.submitButtonTarget.removeAttribute("disabled")})}},{key:"submitSendForm",value:function(){if(this.walletPassphraseTarget.value){$("#passphrase-modal").modal("hide"),this.submitButtonTarget.innerHTML="Sending...",this.submitButtonTarget.setAttribute("disabled","disabled");var e=$("#send-form").serialize();e+="&totalSelectedInputAmountDcr="+this.getSelectedInputsSum(),this.sourceAccountTarget.disabled&&(e+="&source-account="+this.sourceAccountTarget.value),console.log(e);var r=this;a.a.post("/send",e).then(function(n){return function(){console.log(n);var e=n.data;if(e.error)r.setErrorMessage(e.error);else{var t="The transaction was published successfully. Hash: <strong>"+e.txHash+"</strong>";r.setSuccessMessage(t)}}}).catch(function(){r.setErrorMessage("A server error occurred")}).then(function(){r.submitButtonTarget.innerHTML="Send",r.submitButtonTarget.removeAttribute("disabled")})}else this.setErrorMessage("Your wallet passphrase is required")}},{key:"newDestination",value:function(){if(this.validateDestinationsField()){var e=document.importNode(this.destinationTemplateTarget.content,!0);this.destinationsTarget.appendChild(e),1<this.destinationsTarget.querySelectorAll("div.row").length&&this.show(this.removeDestinationButtonTarget)}}},{key:"removeDestination",value:function(){1<this.destinationsTarget.querySelectorAll("div.row").length&&(this.destinationsTarget.removeChild(this.destinationsTarget.querySelector("div.row:last-child")),1<this.destinationsTarget.querySelectorAll("div.row").length||this.hide(this.removeDestinationButtonTarget))}},{key:"validatePassphrase",value:function(){return""!==this.walletPassphraseTarget.value||!(this.passwordErrorTarget.innerHTML='<div class="error">Your wallet passphrase is required</div>')}},{key:"getWalletPassphraseAndSubmit",value:function(){this.validateDestinationsField()&&$("#passphrase-modal").modal()}},{key:"toggleUseCustom",value:function(){if(!this.useCustomTarget.checked)return $("#custom-tx-row").slideUp(),void this.resetCustomizePanel();this.validateDestinationsField()?(this.clearMessages(),this.openCustomizePanel()):this.useCustomTarget.checked=!1}},{key:"toggleSpendUnconfirmed",value:function(){this.useCustomTarget.checked&&(this.resetCustomizePanel(),this.openCustomizePanel())}},{key:"setErrorMessage",value:function(e){this.hide(this.successMessageTarget),this.show(this.errorMessageTarget),this.errorMessageTarget.innerHTML=e}},{key:"setSuccessMessage",value:function(e){var t="The transaction was published successfully. Hash: <strong>".concat(e,"</strong>");this.hide(this.errorMEssageTarget),this.show(this.succesMessageTarget),this.errorMessageTarget.innerHTML=t}},{key:"clearMessages",value:function(){this.hide(this.errorMessageTarget),this.hide(this.successMessageTarget),this.errorsTarget.innerHTML=""}},{key:"hide",value:function(e){e.classList.add("d-none")}},{key:"show",value:function(e){e.classList.remove("d-none")}},{key:"showError",value:function(e){this.errorsTarget.innerHTML+='<div class="error">'.concat(e,"</div>")}}])&&i(n.prototype,r),s&&i(n,s),t}()}});
//# sourceMappingURL=app.js.map